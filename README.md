# Визуализатор Графа Зависимостей для Пакетов NuGet

Этот проект представляет собой CLI-приложение на Python для анализа и визуализации графов зависимостей пакетов NuGet (.NET). Инструмент вручную извлекает зависимости без использования менеджеров пакетов или сторонних библиотек, строит граф с учетом транзитивных зависимостей, применяет фильтры и ограничения глубины, обрабатывает циклы, и предоставляет вывод в виде текстового графа, топологического порядка или диаграмм Mermaid для визуализации.

Инструмент поддерживает три режима работы:
- **Remote**: Извлечение из API репозитория NuGet (например, https://api.nuget.org/v3/index.json).
- **Local**: Парсинг файла .nupkg.
- **Test**: Использование пользовательского JSON-файла для имитации графа (полезно для тестирования с пакетами в виде заглавных латинских букв, например, "A" -> ["B", "C"]).

Разработан поэтапно в рамках университетского задания.


## Использование

Запуск приложения осуществляется через командную строку:
```
python main.py -p <пакет> -r <репозиторий> -m <режим> [-d <глубина>] [-f <фильтр>] [-o <вывод>]
```

- `-p, --package`: Имя пакета (обязательно).
- `-r, --repo`: URL или путь к репозиторию (обязательно).
- `-m, --mode`: Режим (`remote`, `local` или `test`) (обязательно).
- `-d, --max-depth`: Максимальная глубина (по умолчанию 3).
- `-f, --filter`: Подстрока для фильтрации (по умолчанию пустая).
- `-o, --output`: Режим вывода (`graph`, `topological` или `mermaid`) (по умолчанию `graph`).

Примеры команд для каждого этапа описаны в файле `commands.txt`.

## Описание Этапов Разработки

### Этап 1: Минимальный прототип с конфигурацией
Цель: Создать базовое CLI-приложение с поддержкой пользовательских параметров через опции командной строки.

- Параметры: Имя пакета, URL/путь к репозиторию, режим работы, максимальная глубина, фильтр.
- Вывод: Параметры в формате ключ-значение.
- Обработка ошибок: Валидация всех параметров (например, проверка URL, существование пути, положительная глубина).
- Файлы: `main.py` (основной скрипт с парсером `argparse`).

Пример запуска: `python main.py -p numpy -r https://api.nuget.org/v3/index.json -m remote -d 5 -f sci`.

### Этап 2: Сбор данных
Цель: Реализовать логику получения прямых зависимостей пакета в формате NuGet.

- Извлечение зависимостей: Для remote — через NuGet API v3 (index.json, registration); для local — парсинг .nuspec в .nupkg (ZIP + XML).
- Вывод: Прямые зависимости пакета.
- Запрет: Не использовать менеджеры пакетов или сторонние библиотеки.
- Файлы: `dependencies.py` (логика извлечения), обновлённый `main.py`.

Пример запуска: `python main.py -p Newtonsoft.Json -r https://api.nuget.org/v3/index.json -m remote`.

### Этап 3: Основные операции
Цель: Построить полный граф зависимостей с учетом транзитивности, глубины и фильтра.

- Алгоритм: BFS (итеративный) для обхода графа, с обработкой циклов (visited set).
- Фильтр: Исключать пакеты, содержащие подстроку.
- Тестовый режим: Поддержка JSON-файла для имитации графа (пакеты A-Z).
- Вывод: Текстовое представление графа.
- Демонстрация: На различных тестовых случаях (простой граф, цикл, фильтр, ограниченная глубина).
- Файлы: Обновлённый `dependencies.py` (функция `build_dependency_graph`), `main.py`.

Пример запуска: `python main.py -p A -r ./simple.json -m test -d 3`.

### Этап 4: Дополнительные операции
Цель: Добавить операции над графом, включая порядок загрузки зависимостей.

- Топологическая сортировка: Алгоритм Kahn's (BFS с indegree) для определения порядка установки (зависимости сначала).
- Обработка циклов: Частичный порядок с предупреждением.
- Сравнение: С реальным NuGet (расхождения из-за игнора версий/TFM в прототипе).
- Демонстрация: На тестовых и реальных примерах.
- Файлы: Обновлённый `dependencies.py` (функция `topological_sort`), `main.py` (опция `--output topological`).

Пример запуска: `python main.py -p A -r ./simple.json -m test -d 3 --output topological`.

### Этап 5: Визуализация
Цель: Сформировать графическое представление графа.

- Формат: Текстовое описание на языке Mermaid (для рендеринга в инструментах вроде mermaid.live).
- Вывод: Код Mermaid для диаграммы.
- Демонстрация: Для трёх пакетов (Newtonsoft.Json, Microsoft.EntityFrameworkCore, тестовый "A").
- Сравнение: С штатными инструментами NuGet (dotnet list, VS diagrams; расхождения из-за контекста проекта vs обобщённый граф).
- Файлы: Обновлённый `dependencies.py` (функция `generate_mermaid`), `main.py` (опция `--output mermaid`).

Пример запуска: `python main.py -p Newtonsoft.Json -r https://api.nuget.org/v3/index.json -m remote -d 1 --output mermaid`.

## Тестовые Файлы
- `simple.json`, `cycle.json`, `missing.json`: Примеры JSON для тестового режима.
- `commands.txt`: Список команд для демонстрации каждого этапа.
